<%if @data.blank?%>
  <h1 class="alert alert-danger center" >Proceso de Venta</h1>
  <button data-role="button" data-inline="true" onclick="cargar()">Venta Nueva</button>
  <input data-type="search" id="searchForCollapsibleSetChildren">
  <div data-role="collapsible-set" data-filter="true" data-children="> div, > div div ul button" data-inset="true" id="collapsiblesetForFilterChildren" data-input="#searchForCollapsibleSetChildren">
    <%if @padre.present?%>
      <%@padre.each do |padre|%>
        <% @productos = Producto.where("producto_padre_id = ?", padre.id) %>
        <div data-role="collapsible" data-filtertext="<%=padre.nombre%> <%@productos.each do |name|%> <%=name.nombre%> <%=name.clave%> <%end%>">
            <h3><%=padre.nombre%></h3>
            <ul data-role="listview" data-inset="false">
              <%@productos.each do |name|%> 
                <button data-filtertext="<%=name.clave%> <%=name.nombre%>" data-theme="b" onclick="enviar(<%=name.id%>, '<%=name.nombre%>', <%=name.venta%>)" class="ui-grid-a">
                  <div class="ui-block-a"><%=name.nombre%></div>
                  <div class="ui-grid-a">
                    <div class="ui-block-a">Clave: <%= name.clave%></div>
                    <div class="ui-block-b">Venta S/IVA: <%= name.venta%></div>
                  </div> 
                  
                </button>
              <%end%> 
            </ul>
        </div>
      <%end%>
    <%else%>
      <p class="alert alert-danger">No se han registrado productos aun</p>
    <%end%>
  </div>
  <%= render "adicional"%>
  <%= form_tag({:controller => "eventos", :action => "index"}, :method => "get", "id"=>"index") do %>
     <h4 class="alert alert-danger clear center">Nombre de cliente * </h4>
      <div class="col-md-6">
        <input type="text" name="cliente" placeholder="Nombre(s)" id="nom" required> 
      </div>
      <div class="col-md-6">
        <input type="text" name="cliente_apellido" placeholder="Apellido(s)"  id="ape" value=""> 
      </div> 
      <h4 class="alert alert-danger clear center">Productos Seleccionados</h4>
  	<div id="elements"></div>
    <fieldset class="col-md-12">
      <div data-role="fieldcontain" class="col-md-12">
        <label for="select-based-flipswitch">Requiere instalación remota:</label>
        <select id="select-based-flipswitch" name="instalacion" onchange="validarval()" >
          <option value="No">No</option>
          <option value="Remotamente">Remotamente</option>
          <option value="Presencialmente">Presencialmente</option>
        </select>
      </div>
    </fieldset>
    <div class="col-md-12 desaparecetime" id="desaparecetime">
      <h4 class="alert alert-danger clear center">Tiempo de instalación y capacitación en minutos * </h4>
      <div class="col-md-2">
        <input type="number" name="tiempoinstalar" placeholder="35" id="tiempos" > 
      </div>
    </div>
    <div class="col-md-12">
     <%= submit_tag "Enviar" %>
     </div>
  <% end %>
<%end%>

<%if @data.present?%>
  <div class="col-md-8">
    <p class="center">Descargar documento de Estimación con los siguientes elementos:</p>
    <table class="table table-bordered ui-responsive" data-role="table">
      <thead>
        <tr>
          <th>Producto/servicio</th>
          <th>Precio</th>
          <th>Cantidad</th>
        </tr>
      </thead>

      <tbody>
        <%@x = 0%>
        <%i = 0%>
        <%@object.each do |x| %>
          <%@x = @x + (x[0].venta * @cant[i].to_i)%>
          <tr>
            <td><%=x[0].nombre%></td>
            <td><%=x[0].venta%></td>
            <td><%=@cant[i]%></td>
          </tr>
          <%i = i + 1%>
        <% end %>
        <%if @tiempo_instalar.present?%>
          <tr>
            <td>Costo instalacion</td>
            <td><%=@costo_instalar%></td>
            <td><%=@tiempo_instalar%>hrs.</td>
          </tr>
          <%@x = @x + @costo_instalar.to_i%>
        <%end%>
         <tr>
            <td>Total</td>
            <td>Sin iva</td>
            <td><%=@x%></td>
          </tr>
      </tbody>
    </table>

    <%= link_to ' Descargar Estimación',  eventos_path(request.parameters.merge({:format => :xlsx})), :onclick => "$('#index').submit()","data-role" => "button","data-inline" => "true", "data-theme" => "b", "download"=>"fa-download", "data-ajax"=>"false"%>
    <%= link_to ' Descargar Cotización',  eventos_path(request.parameters.merge({:format => :pdf})), :onclick => "$('#index').submit()","data-role" => "button","data-inline" => "true", "data-theme" => "b", "download"=>"fa-download", "data-ajax"=>"false"%>
    <%= link_to ' Descargar carta de aceptacion',  eventos_path(request.parameters.merge({:format => :adicional})), :onclick => "$('#index').submit()","data-role" => "button","data-inline" => "true", "data-theme" => "b", "download"=>"fa-download", "data-ajax"=>"false"%>
    <%= link_to "Regresar", eventos_path, "data-role" => "button","data-inline"=>"true","data-theme" =>"b"%>
  </div>
  <div class="col-md-4">
    <%= image_tag("sos") %>
  </div>
<%end%>
